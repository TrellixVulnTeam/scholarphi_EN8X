%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%                   COLORING MACROS FOR SCHOLAR READER                          %%%
%%%                                                                               %%%
%%% These macros provide custom coloring commands for the TeX files processed by  %%%
%%% the Scholar Reader project. They were designed to work when inserted into     %%%
%%% both TeX and LaTeX files, and with pdftex, latex, and pdflatex engines.       %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Define names of color drivers
% You can check the name of the current driver using '\Gin@driver{}'
\def\pdftexdrivername{pdftex.def}
\def\dvipsdrivername{dvips.def}

% Convenience commands for checking if command is defined or not. Work in TeX and LaTeX
\def\scholarifundefined#1#2{%
\expandafter\ifx\csname #1\endcsname\relax%
#2%
\fi%
}
\def\scholarifdefined#1#2{%
\expandafter\ifx\csname #1\endcsname\relax%
\else%
#2%
\fi%
}

% '@' needs to be processed in command names so we can access lower-level macros
% (e.g., '\current@color', '\Gin@driver') that will be defined by the TeX engines
% to let us know what's doing the coloring, and to let us set colors.
\catcode`@ = 11

\scholarifundefined{scholarsetcolor}{
% Command for setting the color for everything from here onward (even after this 
% this command appears in has terminated.)
\def\scholarsetcolor[#1]#2{%
% If required color commands haven't yet been loaded yet, load them.
\scholarifundefined{colorcommandsloaded}{%
\scholarifundefined{color}{%
\input miniltx%
\input color%
}%
\def\colorcommandsloaded{loaded}%
}%
{\csname color@#1\endcsname\current@color{#2}%
\ifx\Gin@driver\pdftexdrivername%
\pdfcolorstack0 push {\current@color}%
\else\ifx\Gin@driver\dvipsdrivername%
\special{color push \current@color}%
\else\typeout{Coloring not implemented for driver \Gin@driver}\INVALIDCOMMANDFORCEERROR%
\fi\fi%
}}
% Command for reverting a color set in an 'scholarsetcolor' command.
\def\scholarrevertcolor{%
\ifx\Gin@driver\pdftexdrivername%
\pdfcolorstack0 pop%
\else\ifx\Gin@driver\dvipsdrivername%
\special{color pop}%
\else\typeout{Coloring not implemented for driver \Gin@driver}\INVALIDCOMMANDFORCEERROR%
\fi\fi%
}%
}

% Revert '@' to just be a normal character.
\catcode`@ = 12

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%  END OF COLORING MACROS FOR SCHOLAR READER  %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
